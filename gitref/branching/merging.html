<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Merging Branches | My References</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Merging Branches" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="https://xcomfan.github.io/gitref/branching/merging" />
<meta property="og:url" content="https://xcomfan.github.io/gitref/branching/merging" />
<meta property="og:site_name" content="My References" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Merging Branches" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Merging Branches","url":"https://xcomfan.github.io/gitref/branching/merging"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://xcomfan.github.io/feed.xml" title="My References" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">My References</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Merging Branches</h1>
  </header>

  <div class="post-content">
    
<h2 id="basic-merging">Basic merging</h2>

<p>To merge a branch into the branch you are currently working on use the command</p>

<p><code class="language-plaintext highlighter-rouge">git merge &lt;branch_to_merge_from&gt;</code></p>

<p>If the branches you are merging are not diverged (one branch is just ahead of another) when merging, Git can just move pointers around (fast forward).  If however, there was a divergence then Git does a 3 way merge between the two branch tips and the common ancestor of the branches being merged.  When this happens git will create a new commit for the merge known as a merge commit.</p>

<p>To delete a branch you no longer need (once you have merged it into another branch for example) use the -d option</p>

<p><code class="language-plaintext highlighter-rouge">git branch -d &lt;branch_to_delete&gt;</code></p>

<h2 id="basic-merge-conflicts">Basic merge conflicts</h2>

<p>Merge conflicts happen when you change the same part of a file in two branches you are trying to merge.</p>

<p>git status will show you which files are in conflict.  Git will also add conflict resolution markers to the files that have conflicts to help you resolve the conflicts.</p>

<p>After you resolve a conflict use <code class="language-plaintext highlighter-rouge">git add</code> to mark the file as resolved (staging a file marks it as resolved).  You can also use <code class="language-plaintext highlighter-rouge">git-status</code> to confirm all conflicts have been resolved.</p>

<p>Once you are happy with your merge, you can use <code class="language-plaintext highlighter-rouge">git commit</code> to commit the merge.  Git will provide a default commit message, but you have the option to replace that.</p>

<h2 id="advanced-merging">Advanced Merging</h2>

<h3 id="merge-conflicts">Merge conflicts</h3>

<p>When attempting a merge make sure your working tree is clean.  If you have work in progress either commit it to a temporary branch or stash it.  This makes it so that you can undo things when you try to merge.</p>

<p>If you started a merge and get conflicts you can use the below command to abort the merge.</p>

<p><code class="language-plaintext highlighter-rouge">git merge --abort</code></p>

<p>If for some reason you want to start over you can use <code class="language-plaintext highlighter-rouge">git --reset HEAD</code> and return your repo to its last committed state. <strong><em>Note:</em></strong> Any of your uncommitted work will be lost.</p>

<h3 id="ignoring-whitespace">Ignoring whitespace</h3>

<p>A whitespace related conflict looks like every line being being removed on the left side appearing on the right.  By default Git sees all of these lines as being changed, so it can’t merge the files.  If you are seeing a lot of whitespace conflicts you can abort your merge and re-attempt it with the command below.</p>

<p><code class="language-plaintext highlighter-rouge">git merge --Xignore-space-change somebranch</code></p>

<p>The –Xignore-space-change option ignores whitespace completely when comparing lines.  It will treat sequences of one or more whitespace lines as equivalent.</p>

<h3 id="manual-file-re-merging">Manual file re-merging</h3>

<p>You will very likely run into situations where Git can’t automatically fix things in a merge.  In this scenario git allows you to get copies of the 3 states of the conflicting file.</p>

<ul>
  <li>One state is the merge conflict state.</li>
  <li>One state is “my version” of the file (the one you are trying to check in after merge)</li>
  <li>The other version is the “their” version (the one you are trying to merge in)</li>
</ul>

<p>Git stores gives you access to these files under stages that have a number associated with them.</p>

<p>Stage <strong>1</strong> The common ancestor</p>

<p>Stage <strong>2</strong> is your version</p>

<p>Stage <strong>3</strong> is the MERGE_HEAD (the theirs version)</p>

<p>To access these states you can sue the commands below.</p>

<p><code class="language-plaintext highlighter-rouge">git show :1:hello.rb &gt; hello.common.rb</code></p>

<p><code class="language-plaintext highlighter-rouge">git show :2:hello.rb &gt; hello.ours.rb</code></p>

<p><code class="language-plaintext highlighter-rouge">git show :3:hello.rb &gt; hello.theirs.rb</code></p>

<p>Once you have the 3 stages in your working directory you can modify than as needed for example…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dos2unix hello.theirs.rb

git merge-file -p hello.ours hello.common.rb hello.theirs.rb &gt; hello.rb
</code></pre></div></div>

<p>You can use git diff to compare what is in your working directory that you’re about to commit as the result of the merge to ay of these stages.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git diff --ours

git diff --theirs -b

git diff --base -b
</code></pre></div></div>

<p>After you are done fixing the merge you can use git clean to clear our the files you added but no longer need.</p>

<p><code class="language-plaintext highlighter-rouge">git clean -f</code></p>

<h3 id="checking-out-conflicts">Checking out conflicts</h3>

<p>Git checkout with the –conflict option will re-checkout the file again and replace the merge conflict markers.  This can be useful if you want to reset the conflict markers and try the merge again.</p>

<p>You can pass –conflict either diff3 or merge.  With diff 3 you will get a slightly different conflict output showing you the ours, theirs and base version.</p>

<p><code class="language-plaintext highlighter-rouge">git checkout --conflict merge</code></p>

<p><code class="language-plaintext highlighter-rouge">git checkout --conflict diff3</code></p>

<p>If you prefer the diff3 version of the output you can make that your default with the command.</p>

<p><code class="language-plaintext highlighter-rouge">git config --global merge.conflictstyle diff3</code></p>

<p>The diff3 option can be particularly useful when merging large binary files where you just need to pick one side or when you are merging large files from other branches.  You can do the merge then checkout certain files from one side or the other before committing.</p>

<h3 id="merge-log">Merge log</h3>

<p>You can use the triple dot syntax to get a full list of the unique commits that were included in either branch involved in this merge.</p>

<p><code class="language-plaintext highlighter-rouge">git log --oneline --left-right HEAD...MERGE_HEAD</code></p>

<p>This gives you a list of the commits involved, as well as which line of development each commit was on.</p>

<p>The –merge option to git log will only show the commits in either side of the merge that touch a file that’s currently conflicted.</p>

<p><code class="language-plaintext highlighter-rouge">git log --oneline --left-right --merge</code></p>

<p>If you run that with the -p option you get ust the diffs tot he file that ended up in conflict.  This can be really helpful in quickly giving you the context you ned to help understand why something conflicts and how to more intelligently resolve it.</p>

<h3 id="combined-diff-format">Combined diff format</h3>

<p>Since Git stages any merge results that are successful, when you run git diff while in a conflicted merge state, you only get what is currently still in conflict.  This can be helpful to see what you still have to resolve.</p>

<p>When you run git diff directly after a merge conflict it will show you a “Combined Diff”.  This format gives you two columns of data nest to each line.</p>

<ul>
  <li>The first column shows you if that line is different (added or removed) between the ours branch and teh file in your working directory.</li>
  <li>The second column does the same between the “theirs” branch and your working directory copy.</li>
</ul>

<p>As you resolve conflicts and run git diff you will see the progress.</p>

<p>If you run git show on a merge commit you will see this format as well.</p>

<h2 id="undoing-merges">Undoing merges</h2>

<p>Lets say you started work on a topic branch, accidentally merged it to master and want to undo the error.</p>

<p>There are two ways to approach this problem.</p>

<h3 id="fix-the-reference">Fix the reference</h3>

<p>If the unwanted commit only exists on your local repository, the easiest and best solution is to move the branches so they point to where you want the to.</p>

<p>In most cases you can follow the problematic git merge command with <code class="language-plaintext highlighter-rouge">git reset --hard HEAD~</code>  This will reset the branch pointers effectively undoing the merge.</p>

<p>The downside of this approach is that you are rewriting history which is problematic for a shared repository.  It also does not work if you made commits after making the mistake.</p>

<h3 id="reverse-the-commit">Reverse the commit</h3>

<p>Git gives you the option of making a new commit that undoes all the changes from an existing one.  Git calls this option a “revert”</p>

<p><code class="language-plaintext highlighter-rouge">git revert -m 1 HEAD</code></p>

<p>The -m 1 flag indicates which parent is the “mainline” and should be kept.  When you invoke a merge into HEAD, the new commit has two parents: the first one is HEAD and the second is the tip fo the branch being merged.  Git will get confused here if you try to merge in the topic branch again as all the topic changes are technically in master.  To work around this you need to un-revert the original merge since now you want to bring back the changes that were reverted out.</p>

<p><code class="language-plaintext highlighter-rouge">git revert ^M</code></p>

<h2 id="ours-or-theirs-preference-when-merging">Ours or theirs preference when merging</h2>

<p>When merging you can use the -Xours or -Xtheirs options to git merge to tell Git to to prefer either their or your version.  This means if there is a merge conflict the side you are specifying will win and you don’t need to manually do the merging.</p>

<p><code class="language-plaintext highlighter-rouge">git merge -Xours somebranch</code></p>

<p>This option will also work on the merge-file command for individual file  merges.</p>

<p><code class="language-plaintext highlighter-rouge">git merge-file --ours</code></p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">My References</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">My References</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
