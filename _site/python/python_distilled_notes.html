<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Python Basics | My References</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Python Basics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/python/python_distilled_notes.html" />
<meta property="og:url" content="http://localhost:4000/python/python_distilled_notes.html" />
<meta property="og:site_name" content="My References" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Python Basics" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Python Basics","url":"http://localhost:4000/python/python_distilled_notes.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="My References" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">My References</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Python Basics</h1>
  </header>

  <div class="post-content">
    <h2 id="python-basics">Python Basics</h2>

<p>When you use Python in REPL the results of the last statement are available in the <code class="language-plaintext highlighter-rouge">_</code> variable.  This is only available in REPL.</p>

<p><code class="language-plaintext highlighter-rouge">divmod(x,y)</code> Returns (x // y, x % y)</p>

<p>Immediately adjacent string literals are concatenated into a single string.  The two examles below are quivalent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'''Content-type: text/html

&lt;h1&gt; Hello World &lt;/h1&gt;
Click &lt;a href="http://www.python.org"&gt;here&lt;/a&gt;.
'''</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span>
<span class="s">'Content-type: text/html</span><span class="se">\n</span><span class="s">'</span>
<span class="s">'</span><span class="se">\n</span><span class="s">'</span>
<span class="s">'&lt;h1&gt; Hello World &lt;/h1&gt;</span><span class="se">\n</span><span class="s">'</span>
<span class="s">'Clock &lt;a href="http://www.python.org"&gt;here&lt;/a&gt;</span><span class="se">\n</span><span class="s">'</span>
<span class="p">)</span>


<span class="n">String</span> <span class="n">methods</span> <span class="n">just</span> <span class="n">to</span> <span class="n">add</span> <span class="n">to</span> <span class="n">your</span> <span class="n">reference</span> <span class="n">you</span> <span class="n">know</span> <span class="n">this</span> <span class="n">stuff</span> <span class="n">mostly</span><span class="p">...</span>

<span class="n">Method</span> <span class="n">Description</span>

<span class="n">s</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">prefix</span> <span class="p">[,</span><span class="n">start</span> <span class="p">[,</span><span class="n">end</span><span class="p">]])</span> <span class="n">Checks</span> <span class="n">whether</span> <span class="n">a</span> <span class="n">string</span> <span class="n">ends</span> <span class="k">with</span> <span class="n">prefix</span><span class="p">.</span>

<span class="n">s</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">sub</span> <span class="p">[,</span> <span class="n">start</span> <span class="p">[,</span><span class="n">end</span><span class="p">]])</span> <span class="n">Finds</span> <span class="n">the</span> <span class="n">first</span> <span class="n">occurrence</span> <span class="n">of</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">substring</span> <span class="n">sub</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">.</span>

<span class="n">s</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="n">Converts</span> <span class="n">to</span> <span class="n">lowercase</span><span class="p">.</span>

<span class="n">s</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="p">[,</span><span class="n">maxreplace</span><span class="p">])</span> <span class="n">Replaces</span> <span class="n">a</span> <span class="n">substring</span><span class="p">.</span>

<span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">([</span><span class="n">sep</span> <span class="p">[,</span><span class="n">maxsplit</span><span class="p">]])</span> <span class="n">Splits</span> <span class="n">a</span> <span class="n">string</span> <span class="n">using</span> <span class="n">sep</span> <span class="k">as</span> <span class="n">a</span> <span class="n">delimiter</span><span class="p">.</span> <span class="n">maxsplit</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">splits</span> <span class="n">to</span> <span class="n">perform</span><span class="p">.</span>

<span class="n">s</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span> <span class="p">[,</span><span class="n">start</span> <span class="p">[,</span><span class="n">end</span><span class="p">]])</span> <span class="n">Checks</span> <span class="n">whether</span> <span class="n">a</span> <span class="n">string</span> <span class="n">starts</span> <span class="k">with</span> <span class="n">prefix</span><span class="p">.</span>

<span class="n">s</span><span class="p">.</span><span class="n">strip</span><span class="p">([</span><span class="n">chrs</span><span class="p">])</span> <span class="n">Removes</span> <span class="n">leading</span> <span class="ow">and</span> <span class="n">trailing</span> <span class="n">whitespace</span> <span class="ow">or</span> <span class="n">characters</span> <span class="n">supplied</span> <span class="ow">in</span> <span class="n">chrs</span><span class="p">.</span>

<span class="n">s</span><span class="p">.</span><span class="n">upper</span><span class="p">()</span> <span class="n">Converts</span> <span class="n">a</span> <span class="n">string</span> <span class="n">to</span> <span class="n">uppercase</span><span class="p">.</span>

<span class="n">Although</span> <span class="nb">str</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">repr</span><span class="p">()</span> <span class="n">both</span> <span class="n">create</span> <span class="n">strings</span><span class="p">,</span> <span class="n">their</span> <span class="n">output</span> <span class="ow">is</span> <span class="n">often</span> <span class="n">different</span><span class="p">.</span> <span class="nb">str</span><span class="p">()</span> <span class="n">produces</span> <span class="n">the</span> <span class="n">output</span> <span class="n">that</span> <span class="n">you</span> <span class="n">get</span> <span class="n">when</span> <span class="n">you</span> <span class="n">use</span> <span class="n">the</span> <span class="k">print</span><span class="p">()</span> <span class="n">function</span><span class="p">,</span> <span class="n">whereas</span> <span class="nb">repr</span><span class="p">()</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">string</span> <span class="n">that</span> <span class="n">you</span> <span class="nb">type</span> <span class="n">into</span> <span class="n">a</span> <span class="n">program</span> <span class="n">to</span> <span class="n">exactly</span> <span class="n">represent</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">an</span> <span class="nb">object</span><span class="p">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">:</span>

<span class="n">The</span> <span class="nb">format</span><span class="p">()</span> <span class="n">function</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">a</span> <span class="n">single</span> <span class="n">value</span> <span class="n">to</span> <span class="n">a</span> <span class="n">string</span> <span class="k">with</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">formatting</span> <span class="n">applied</span><span class="p">.</span> <span class="n">For</span> <span class="n">example</span>

<span class="sb">``</span><span class="err">`</span><span class="n">python</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">12.34567</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">'0.2f'</span><span class="p">)</span>
<span class="s">'12.35'</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Sometimes you might want to read data typed interactively in the console. To do that, use the input() function. For example</p>

<p>The input() function returns all of the typed text up to the terminating newline, which is not included</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter your name : '</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p>The elements of a set are typically restricted to immutable objects. For example, you can make a set of numbers, strings, or tuples. However, you can’t make a set containing lists. Most common objects will probably work with a set, however—when in doubt, try it.</p>

<p>If working with existing data, you can also create a set using a set comprehension. For example, this statement turns all of the stock names from the data in the previous section into a set: <code class="language-plaintext highlighter-rouge">names = { s[0] for s in portfolio }</code></p>

<p>To create an empty set <code class="language-plaintext highlighter-rouge">r = set()</code></p>

<p>New items can be added to a set sing <code class="language-plaintext highlighter-rouge">add()</code> or <code class="language-plaintext highlighter-rouge">update()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">'DIS'</span><span class="p">)</span>                   <span class="c1"># Add a single item
</span><span class="n">s</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="s">'JJ'</span><span class="p">,</span> <span class="s">'GE'</span><span class="p">,</span> <span class="s">'ACME'</span><span class="p">})</span> <span class="c1"># Adds multiple items to s
</span></code></pre></div></div>

<p>An item can be removed using <code class="language-plaintext highlighter-rouge">remove()</code> or <code class="language-plaintext highlighter-rouge">discard()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'IBM'</span><span class="p">)</span>    <span class="c1"># Remove 'IBM' or raise KeyError if absent.
</span><span class="n">s</span><span class="p">.</span><span class="n">discard</span><span class="p">(</span><span class="s">'SCOX'</span><span class="p">)</span>  <span class="c1"># Remove 'SCOX' if it exists.
</span></code></pre></div></div>

<p>The difference between <code class="language-plaintext highlighter-rouge">remove()</code> and <code class="language-plaintext highlighter-rouge">discard()</code> is that <code class="language-plaintext highlighter-rouge">discard()</code> doesn’t raise an exception if the item isn’t present.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">portfolio</span> <span class="o">=</span> <span class="p">[</span>
   <span class="p">(</span><span class="s">'ACME'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">92.34</span><span class="p">),</span>
   <span class="p">(</span><span class="s">'IBM'</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">102.25</span><span class="p">),</span>
   <span class="p">(</span><span class="s">'PHP'</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mf">74.50</span><span class="p">),</span>
   <span class="p">(</span><span class="s">'IBM'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">124.75</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">total_shares</span> <span class="o">=</span> <span class="p">{</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span> <span class="p">}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">shares</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="n">total_shares</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shares</span>

<span class="c1"># total_shares = {'IBM': 125, 'ACME': 50, 'PHP': 40}
</span></code></pre></div></div>

<p>In this example, <code class="language-plaintext highlighter-rouge">{ s[0]: 0 for s in portfolio }</code> is an example of a dictionary comprehension. It creates a dictionary of key-value pairs from another collection of data. In this case, it’s making an initial dictionary mapping stock names to 0. The for loop that follows iterates over the dictionary and adds up all of the held shares for each stock symbol.</p>

<p>Many common data processing tasks such as this one have already been implemented by library modules. For example, the collections module has a Counter object that can be used for this task:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">total_shares</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">shares</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="n">total_shares</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shares</span>

<span class="c1"># total_shares = Counter({'IBM': 125, 'ACME': 50, 'PHP': 40})
</span></code></pre></div></div>

<p>If you want to exit a program you do it by …</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">raise</span> <span class="nb">SystemExit</span><span class="p">()</span>                      <span class="c1"># Exit with no error message
</span><span class="k">raise</span> <span class="nb">SystemExit</span><span class="p">(</span><span class="s">"Something is wrong"</span><span class="p">)</span>  <span class="c1"># Exit with error
</span></code></pre></div></div>

<p>At exit the interpeter makes a best effort to garbage collect all active objects, however if you need to perform a specific cleanup action (removes files or close a connection) you can register it with <code class="language-plaintext highlighter-rouge">atexit</code> module as follows…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">atexit</span>

<span class="c1"># Example
</span><span class="n">connection</span> <span class="o">=</span> <span class="n">open_connection</span><span class="p">(</span><span class="s">"deaddot.com"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cleanup</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">"Going away..."</span>
    <span class="n">close_connection</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

<span class="n">atexit</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>
</code></pre></div></div>

<p>There is a <code class="language-plaintext highlighter-rouge">csv</code> library for dealing with comma separated files</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># readport.py
#
# Reads a file of 'NAME,SHARES,PRICE' data
</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="k">def</span> <span class="nf">read_portfolio</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">portfolio</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">csv</span><span class="p">.</span><span class="n">reader</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">shares</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">holding</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shares</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
                <span class="n">portfolio</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">holding</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'Bad row:'</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'Reason:'</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">portfolio</span>
</code></pre></div></div>

<p>If you need to know where a package is coming from on your system inspect the <code class="language-plaintext highlighter-rouge">__-file__</code> attribute of a package after importing it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pandas</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pandas</span><span class="p">.</span><span class="n">__file__</span>
<span class="s">'/usr/local/lib/python3.8/site-packages/pandas/__init__.py'</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h2 id="chapter-2-operators-expressions-and-data-manipulation">Chapter 2: Operators, Expressions and Data Manipulation</h2>

<p>In numeric literals you can use an underscoe <code class="language-plaintext highlighter-rouge">_</code> to to make a big interger easier to read.  Fore exampe…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">123_456_789</span>
<span class="mh">0x1234_5678</span>
<span class="mb">0b111_00_101</span>
<span class="mf">123.789_012</span>
</code></pre></div></div>

<p>The assignment of a value and the evaluation of an expression are separate concepts.  You can’t include the assignment operator as part of an expression:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="n">line</span><span class="o">=</span><span class="nb">file</span><span class="p">.</span><span class="n">readline</span><span class="p">():</span>          <span class="c1"># Syntax Error.
</span>    <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></div>

<p>That is unless you use the walrus operator <code class="language-plaintext highlighter-rouge">:=</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="n">line</span><span class="p">:</span><span class="o">=</span><span class="nb">file</span><span class="p">.</span><span class="n">readline</span><span class="p">()):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">:=</code> operator is usually used in combination with statements such as <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">while</code>.  In fact, using it as a normal assignment operator results in a syntax error unless you put parenthesis around it.</p>

<p>Identity operators <code class="language-plaintext highlighter-rouge">x is y</code> and <code class="language-plaintext highlighter-rouge">x is not y</code> test two values to see whether they refer to literally the same object in memory.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Alternative
</span><span class="n">result</span> <span class="o">=</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">minvalue</span> <span class="o">=</span> <span class="n">a</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">minvalue</span> <span class="o">=</span> <span class="n">b</span>

<span class="c1"># can be shortened to 
</span><span class="n">minvalue</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span> <span class="k">else</span> <span class="n">b</span>
</code></pre></div></div>

<p>Any iterable can be expanded when writing out list, tuple, and set literals using the <code class="language-plaintext highlighter-rouge">*</code>.  This is called splatting.  Youc an use as many <code class="language-plaintext highlighter-rouge">*</code> expansions as you like but be aware some structures only support one time iteration.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>      <span class="c1"># a = [10, 1, 2, 3, 11]        (list)
</span><span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">)</span>  <span class="c1"># b = [1, 2, 3, 10, 1, 2, 3]  (tuple)
</span><span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">}</span>      <span class="c1"># c = {1, 2, 3, 10, 11}        (set)
</span></code></pre></div></div>

<p>All variables used in a list comprehension are private to the comprehension and won’t over write outside variables. For example…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">squares</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">squares</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span>
<span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h2 id="chapter-3-program-structure-and-control-flow">Chapter 3: Program Structure and Control Flow</h2>

<p>In for loops the <code class="language-plaintext highlighter-rouge">i</code> in <code class="language-plaintext highlighter-rouge">for i in s</code> is not locally scoped.  This means that if there was a prior i definition this will over write it and after loop completes i will remain at the last set value.</p>

<p>If elements produced by iteration are the same size you can unpack their values into separate iteration variables.  For example</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="p">]</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">statements</span>
</code></pre></div></div>

<p>Sometimes a throw away variable such as <code class="language-plaintext highlighter-rouge">_</code> is used for example</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">statements</span>
</code></pre></div></div>

<p>If your iterables produce different sizes you can wild card unpacking to place multiple values into a variable.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="p">]</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">statements</span>            <span class="c1"># x = 1, y = 2, extra = []
</span>                          <span class="c1"># x = 3, y = 4, extra = [5]
</span>                          <span class="c1"># x = 6, y = 7, extra = [8, 9]
</span>                          <span class="c1"># ...
</span></code></pre></div></div>

<p>Instead of doing this…</p>

<p>```pyti = 0
for x in s:
    statements
    i += 1</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
You can do this...

```python
&gt;&gt;&gt; arrmatey = ['a', 'b', 'c', 'd']
&gt;&gt;&gt; for i, x in enumerate(arrmatey):
...   print(f"i = {i} x = {x}")
...
i = 0 x = a
i = 1 x = b
i = 2 x = c
i = 3 x = d
&gt;&gt;&gt; for i, x in enumerate(arrmatey, start=2):
...   print(f"i = {i} x = {x}")
...
i = 2 x = a
i = 3 x = b
i = 4 x = c
i = 5 x = d
&gt;&gt;&gt;
</code></pre></div></div>

<p>Instead of this …</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># s and t are two sequences
</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>     <span class="c1"># Take an item from s
</span>    <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>     <span class="c1"># Take an item from t
</span>    <span class="n">statements</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></div>

<p>You can do this…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># s and t are two sequences
</span><span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">statements</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">zip(s, t)</code> combines iterables <code class="language-plaintext highlighter-rouge">s</code> and <code class="language-plaintext highlighter-rouge">t</code> into an iterable of tuples <code class="language-plaintext highlighter-rouge">(s[0]),t[0])</code>.  The result of <code class="language-plaintext highlighter-rouge">zip()</code> is an iterator that produces the results when iterated.  If you want the results as a list use <code class="language-plaintext highlighter-rouge">list(zip())</code></p>

<p><code class="language-plaintext highlighter-rouge">break</code> and <code class="language-plaintext highlighter-rouge">continue</code> apply only to the innermost loop being executed.  If you need to break out of a deeply nested loop structure, you can use an exception.</p>

<p>The <code class="language-plaintext highlighter-rouge">else</code> clause of a for loop only executes if a for loop runs to completion.  If loop is terminated with a break the clause is skipped.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># for-else
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'foo.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c1"># process the stripped line
</span>        <span class="p">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'Missing section separator'</span><span class="p">)</span>
</code></pre></div></div>

<p>The primary use for <code class="language-plaintext highlighter-rouge">else</code> clause of <code class="language-plaintext highlighter-rouge">for</code> loop is in code that iterates over data but needs to set or check some kind of flag or condition if the loop breaks prematurely.  Without else the above code would have to be written as…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">found_separator</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'foo.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped</span><span class="p">:</span>
            <span class="n">found_separator</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
        <span class="c1"># process the stripped line
</span>        <span class="p">...</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_separator</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'Missing section separator'</span><span class="p">)</span>
</code></pre></div></div>

<p>As a matter of style you should only catch Exceptions from which your code can recover.</p>

<p>If the <code class="language-plaintext highlighter-rouge">raise</code> word is used by itself, the previously handled exception is raised again.  This works only while handling a previously raised exception for example…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'foo.txt'</span><span class="p">,</span> <span class="s">'rt'</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Well, that didn't work."</span><span class="p">)</span>
    <span class="k">raise</span>       <span class="c1"># Re-raises current exception
</span></code></pre></div></div>

<p>The most common Python built in excption types are …</p>

<table>
  <thead>
    <tr>
      <th>Exception Class</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>AssertionError</td>
      <td>Failed assert statement</td>
    </tr>
    <tr>
      <td>AttributeError</td>
      <td>Bad attribute lookup on an object</td>
    </tr>
    <tr>
      <td>EOFError</td>
      <td>End of file</td>
    </tr>
    <tr>
      <td>MemoryError</td>
      <td>Recoverable out-of-memory error</td>
    </tr>
    <tr>
      <td>NameError</td>
      <td>Name not found in the local or global namespace</td>
    </tr>
    <tr>
      <td>NotImplementedError</td>
      <td>Unimplemented feature</td>
    </tr>
    <tr>
      <td>RuntimeError</td>
      <td>A generic “something bad happened” error</td>
    </tr>
    <tr>
      <td>TypeError</td>
      <td>Operation applied to an object of the wrong type</td>
    </tr>
    <tr>
      <td>unboundLocalError</td>
      <td>Usage of local variable before a value is assigned</td>
    </tr>
  </tbody>
</table>

<p>Normally exceptions are used for handling of errors but a couple (in the below table)
are used to alter the control flow.</p>

<table>
  <thead>
    <tr>
      <th>Exception Class</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SystemExit</td>
      <td>Raised to indicate program exit</td>
    </tr>
    <tr>
      <td>KeyboardInterrupt</td>
      <td>Raised when a program is interrupted via Control-C</td>
    </tr>
    <tr>
      <td>StopIteration</td>
      <td>Raised signal to end of iteration</td>
    </tr>
  </tbody>
</table>

<p>The <code class="language-plaintext highlighter-rouge">SystemExit</code> exception is used to make a program terminate on purpose.  As an argument you can either provide an integer exit code or a string message.  Is a string is given, it is printed to <code class="language-plaintext highlighter-rouge">sys.stderr</code> and the program is terminated with an exit code of 1.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">SystemExit</span><span class="p">(</span><span class="sa">f</span><span class="s">'Usage: </span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> filename)

filename = sys.argv[1]
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">KeyboardInterrupt</code> exception is raised when the program receives a <code class="language-plaintext highlighter-rouge">SIGINT</code> signal (ctr C from terminal).  This exception is a bit unusual in that it is asynchronous - Meaning that it could occur at almost any time and on any statement in your program.  The default behavior of Python is to simply terminate when this happens.  If you want to cotnrol the delivery of <code class="language-plaintext highlighter-rouge">SIGINT</code>, the <code class="language-plaintext highlighter-rouge">signal</code> library can be used which will be covered later.</p>

<h3 id="chained-exceptions">Chained Exceptions</h3>

<p>Sometimes in response to an exception you want to raise a different exception.  To do this raise a chained exception like this…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ApplicationError</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">do_something</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">'N/A'</span><span class="p">)</span>    <span class="c1"># raises ValueError
</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">do_something</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="s">'It failed'</span><span class="p">)</span> <span class="k">from</span> <span class="n">e</span>
</code></pre></div></div>

<p>If an uncaught <code class="language-plaintext highlighter-rouge">ApplicationError</code> occurs, you will get a message that includes both exceptions for example…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">spam</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"c.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">9</span><span class="p">,</span> <span class="ow">in</span> <span class="n">spam</span>
    <span class="n">do_something</span><span class="p">()</span>
  <span class="n">File</span> <span class="s">"c.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="n">do_something</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">'N/A'</span><span class="p">)</span>
<span class="nb">ValueError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">literal</span> <span class="k">for</span> <span class="nb">int</span><span class="p">()</span> <span class="k">with</span> <span class="n">base</span> <span class="mi">10</span><span class="p">:</span> <span class="s">'N/A'</span>

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s">"c.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">11</span><span class="p">,</span> <span class="ow">in</span> <span class="n">spam</span>
    <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="s">'It failed'</span><span class="p">)</span> <span class="k">from</span> <span class="n">e</span>
<span class="n">__main__</span><span class="p">.</span><span class="n">ApplicationError</span><span class="p">:</span> <span class="n">It</span> <span class="n">failed</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>If you catch an <code class="language-plaintext highlighter-rouge">ApplicationError</code>, the <code class="language-plaintext highlighter-rouge">__cause__</code> attribute of the resulting exception will contain the other exception.  For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="n">spam</span><span class="p">()</span>
<span class="k">except</span> <span class="n">ApplicationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'It failed. Reason:'</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">__cause__</span><span class="p">)</span>
</code></pre></div></div>

<p>If you want to raise a new exception without including the chain of other exceptions, raise an error from <code class="language-plaintext highlighter-rouge">None</code> like this…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">spam</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">do_something</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="s">'It failed'</span><span class="p">)</span> <span class="k">from</span> <span class="bp">None</span>
</code></pre></div></div>

<p>If an unexpected exception is raised while handling another exception the <code class="language-plaintext highlighter-rouge">__context__</code> attribute (instead of <code class="language-plaintext highlighter-rouge">__cause__</code>) holds information about the exception that was being handled when the error occurred.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="n">spam</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'It failed. Reason:'</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">__context__</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'While handling:'</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">__context__</span><span class="p">)</span>
</code></pre></div></div>

<p>There is an important distinction between expected and unexpected exceptions in exception chains. In the first example, the code was written so that the possibility of an exception was anticipated. For example, code was explicitly wrapped in a try-except block:</p>

<p>The difference between these two cases is subtle but important. That is why exception chaining information is placed into either the <code class="language-plaintext highlighter-rouge">__cause__</code> or the <code class="language-plaintext highlighter-rouge">__context__</code> attribute. The <code class="language-plaintext highlighter-rouge">__cause__</code> attribute is reserved for when you’re expecting the possibility of a failure. The <code class="language-plaintext highlighter-rouge">__context__</code> attribute is set in both cases, but would be the only source of information for an unexpected exception raised while handling another exception.</p>

<h3 id="exception-tracebacks">Exception Tracebacks</h3>

<p>The traceback is stored in the <code class="language-plaintext highlighter-rouge">__traceback__</code> attribute of an exception.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">traceback</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">spam</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">tblines</span> <span class="o">=</span> <span class="n">traceback</span><span class="p">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">__traceback__</span><span class="p">)</span>
    <span class="n">tbmsg</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">tblines</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'It failed:'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tbmsg</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">format_exception()</code> in above example produces a list of strings containing the output Python would normally produce in a traceback message.  As input you provide the exception type, value and traceback.</p>

<h3 id="exception-handling-advice">Exception Handling Advice</h3>

<p>If an operation fails and there is nothing you can do to recover from the failusre (such as can’t open file because of a bad filename for example) Its better to just let it fail and let the exception propagate to upper levels.</p>

<p>When catching errors try to make your <code class="language-plaintext highlighter-rouge">except</code> clause as specific as possible.</p>

<p>Use your own defined errors.  If a program crashes with an error from the standard libraries its hard to figure out if its your code or not, but if you defined you won exceptions its easy to tell if it was your code or not.</p>

<h3 id="context-managers-and-the-with-statement">Context Managers and the with statement</h3>

<p>The <code class="language-plaintext highlighter-rouge">with obs</code> statement accepts an optional <code class="language-plaintext highlighter-rouge">as var</code> specifier.  If given, the value returned by <code class="language-plaintext highlighter-rouge">obj.__enter__()</code> is placed into <code class="language-plaintext highlighter-rouge">var</code>.  This value is commonly the same as <code class="language-plaintext highlighter-rouge">obj</code> because this allows an object to be constructed and used as a context manager in the same step.  For example…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Manager</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">with</span> <span class="n">Manager</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="n">m</span><span class="p">.</span><span class="n">yow</span><span class="p">()</span>
</code></pre></div></div>

<p>Another more interesting example…  This class allows you to make a sequence of modificatiosn to an existing list.  However, the modifications only take effect if no exceptions occur.  Otherwise, the original list is left unmodified.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ListTransaction</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thelist</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thelist</span> <span class="o">=</span> <span class="n">thelist</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">workingcopy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">thelist</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">workingcopy</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">thelist</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">workingcopy</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

<span class="k">with</span> <span class="n">ListTransaction</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="k">as</span> <span class="n">working</span><span class="p">:</span>
    <span class="n">working</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">working</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>       <span class="c1"># Produces [1,2,3,4,5]
</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">ListTransaction</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="k">as</span> <span class="n">working</span><span class="p">:</span>
        <span class="n">working</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">working</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">"We're hosed!"</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">RuntimeError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>   <span class="c1"># Produces [1,2,3,4,5]
</span></code></pre></div></div>

<p>You should take a look at the default options available in <code class="language-plaintext highlighter-rouge">contextlib</code> standard library.</p>

<h3 id="assertions-and-debug">Assertions and <strong>debug</strong></h3>

<p>The <code class="language-plaintext highlighter-rouge">assert</code> statement should not be used for code that must be executed to make the program correct because it won’t be executed if Python is run in optimized mode (specified with the -O option to the interpreter).  Don’t use it to check user input for example.</p>

<h2 id="chapter-4-objects-types-and-protocols">Chapter 4: Objects, Types and Protocols</h2>

<h3 id="object-identity-and-type">Object Identity and Type</h3>

<p>The built in function <code class="language-plaintext highlighter-rouge">id()</code> returns the identity of an object.  The identity is an integer that usually corresponds to the object’s location in memory.  The <code class="language-plaintext highlighter-rouge">is</code> and <code class="language-plaintext highlighter-rouge">is not</code> operators compare the identities of two objects.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compare two objects
</span><span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'same object'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'same value'</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'same type'</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="n">same</span> <span class="nb">object</span>
<span class="n">same</span> <span class="n">value</span>
<span class="n">same</span> <span class="nb">type</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">same</span> <span class="n">value</span>
<span class="n">same</span> <span class="nb">type</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">same</span> <span class="nb">type</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">isinstance(instance, type)</code> function is the preferred way to check a value against a type because it is aware of subtypes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="n">maxval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</code></pre></div></div>

<p>In practice this type checking is not extremely useful.</p>

<h3 id="reference-counting-and-garbage-collection">Reference Counting and Garbage Collection</h3>

<p>The current reference count of an object can be obtained using the <code class="language-plaintext highlighter-rouge">sys.getrefcount()</code> function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">37</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">7</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Ref count is usually higher than you would expect as interpreter aggressively shares.</p>

<p>You con fine tune how garbage collection works using functions in the <code class="language-plaintext highlighter-rouge">gc</code> standard library.</p>

<p>If you want to force trigger garbage collection you can use <code class="language-plaintext highlighter-rouge">gc.collect()</code>.  One example of a time when you want to do this is when working with gigantic data sets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">some_calculation</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">create_giant_data_structure</span><span class="p">()</span>
    <span class="c1"># Use data for some part of a calculation
</span>    <span class="p">...</span>
    <span class="c1"># Release the data
</span>    <span class="k">del</span> <span class="n">data</span>

    <span class="c1"># Calculation continues
</span>    <span class="p">...</span>
</code></pre></div></div>

<p>In the above example <code class="language-plaintext highlighter-rouge">del data</code> means the data variable is no longer needed.  Without the <code class="language-plaintext highlighter-rouge">del</code> statement the object would persist till data variable is out of scope.</p>

<h3 id="references-and-copies">References and Copies</h3>

<p>Example of deep copy below…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Shallow copy
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>           <span class="c1"># Create a shallow copy of a.
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">a</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>         <span class="c1"># Append element to b.
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="mi">100</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>                     <span class="c1"># Notice that a is unchanged
</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>        <span class="c1"># Modify an element inside b
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="mi">100</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>                     <span class="c1"># Notice the change inside a
</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span>

<span class="c1"># Deep copy
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">copy</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">copy</span><span class="p">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>                  <span class="c1"># Notice that a is unchanged
</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Avoid deepcopy fi you can as its kind of slow to execute.  Alos <code class="language-plaintext highlighter-rouge">deepcopy()</code> will fail with objects that involve system or runtime state (such as open files, network connections, threads, generators and so on..)</p>

<h3 id="object-representation-and-printing">Object Representation and Printing</h3>

<p><code class="language-plaintext highlighter-rouge">repr(x)</code> give you a representation of the object whereas <code class="language-plaintext highlighter-rouge">str</code> is the string printing.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">repr</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="s">'datetime.date(2012, 12, 21)'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="n">datetime</span><span class="p">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'The date is: </span><span class="si">{</span><span class="n">d</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">The</span> <span class="n">date</span> <span class="ow">is</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Note the <code class="language-plaintext highlighter-rouge">!r</code> suffix can be added in string formatting to produce the value of <code class="language-plaintext highlighter-rouge">repr()</code> instead of the normal string version.</p>

<h3 id="first-class-objects">First Class Objects</h3>

<p>All objects in Python are “First class object” which means that all objects that can be assigned to a name can also be treated as data.  As data objects can be stored as variables, passed as arguments, returned from functions, compared against other object and more.  One example of this is functions are first class objects and can be inserted into a dictionary.</p>

<p>Just a cool example below of creating list of types from a string using he fist class object nature of Python.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">line</span> <span class="o">=</span> <span class="s">'ACME,100,490.10'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">column_types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">ty</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">ty</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">column_types</span><span class="p">,</span> <span class="n">parts</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">row</span>
<span class="p">[</span><span class="s">'ACME'</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">490.1</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Placing functions in dicts is a common way of avoiding complex if-elif-else statements.</p>

<h3 id="object-protocol">Object protocol</h3>

<p>In additon to <code class="language-plaintext highlighter-rouge">__init__</code> there is also new but that is rarely used unless you are doing some magic that needs to bypass <code class="language-plaintext highlighter-rouge">__init__</code>.  Its used in certain design patterns such as singletons and caching.</p>

<p><code class="language-plaintext highlighter-rouge">__del__</code> is invoked when an instance is about to be garbage collected.</p>

<h3 id="container-protocol">Container protocol</h3>

<p>If you want to build an object that contains thins (such as a list of dict) you need to implement.</p>

<p><code class="language-plaintext highlighter-rouge">__len__(self)</code> - returns lenght of self</p>

<p><code class="language-plaintext highlighter-rouge">__getitem__(self, key)</code> - Returns self[key]</p>

<p><code class="language-plaintext highlighter-rouge">__setitem__(self, key, value)</code> - Sets self[key] = value</p>

<p><code class="language-plaintext highlighter-rouge">delitem__(self, key)</code> - deletes self[key]</p>

<p><code class="language-plaintext highlighter-rouge">__contains__(self, obj)</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>               <span class="c1"># a.__len__()
</span><span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>             <span class="c1"># x = a.__getitem__(2)
</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>             <span class="c1"># a.__setitem__(1,7)
</span><span class="k">del</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>             <span class="c1"># a.__delitem__(2)
</span><span class="mi">5</span> <span class="ow">in</span> <span class="n">a</span>               <span class="c1"># a.__contains__(5)
</span></code></pre></div></div>

<h3 id="iteration-protocol">Iteration Protocol</h3>

<p>If an instance, obj, supports iteration, it provides a method, <code class="language-plaintext highlighter-rouge">obj.__iter__()</code>, that returns an iterator. An iterator iter, in turn, implements a single method, <code class="language-plaintext highlighter-rouge">iter.__next__()</code>, that returns the next object or raises <code class="language-plaintext highlighter-rouge">StopIteration</code> to signal the end of iteration. An object may optionally provide a reversed iterator if it implements the <code class="language-plaintext highlighter-rouge">__reversed__()</code> special method. This method should return an iterator object with the same interface as a normal iterator (that is, a <code class="language-plaintext highlighter-rouge">__next__()</code> method that raises <code class="language-plaintext highlighter-rouge">StopIteration</code> at the end of iteration).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_iter</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">__iter__</span><span class="p">()</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
         <span class="n">x</span> <span class="o">=</span> <span class="n">_iter</span><span class="p">.</span><span class="n">__next__</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
         <span class="k">break</span>
    <span class="c1"># Do statements in body of for loop
</span>    <span class="p">...</span>
</code></pre></div></div>

<p>A common implementation for iteration is to use a generator function involving <code class="language-plaintext highlighter-rouge">yield</code> for example…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FRange</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">start</span>
        <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">x</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">step</span>

<span class="c1"># Example use:
</span><span class="n">nums</span> <span class="o">=</span> <span class="n">FRange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     <span class="c1"># 0.0, 0.1, 0.2, 0.3, ...
</span></code></pre></div></div>

<h3 id="function-protocol">Function Protocol</h3>

<p>An object can emulate a function by providing the <code class="language-plaintext highlighter-rouge">__call__()</code> method. If an object, x, provides this method, it can be invoked like a function. That is, <code class="language-plaintext highlighter-rouge">x(arg1, arg2, ...)</code> invokes <code class="language-plaintext highlighter-rouge">x.__call__(arg1, arg2, ...)</code>.</p>

<h3 id="context-manager-protocol">Context Manager Protocol</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">context</span> <span class="p">[</span> <span class="k">as</span> <span class="n">var</span><span class="p">]:</span>
    <span class="n">statements</span>
</code></pre></div></div>

<p>A context object is expected to implement the following methods.</p>

<p><code class="language-plaintext highlighter-rouge">__enter__(self)</code> - Called when entering a new context.  The return value is placed in the variable listed with the <code class="language-plaintext highlighter-rouge">as</code> specifier to the <code class="language-plaintext highlighter-rouge">with</code> statement.</p>

<p><code class="language-plaintext highlighter-rouge">__exit__(self, type, value, tb)</code> - Called when leaving a context (when you are done with the statements).  if an exception occurred <code class="language-plaintext highlighter-rouge">type</code>, <code class="language-plaintext highlighter-rouge">value</code> and <code class="language-plaintext highlighter-rouge">tb</code> have the exception type, value and traceback information.</p>

<h3 id="being-pythonic">Being “Pythonic”</h3>

<p>Write a good <code class="language-plaintext highlighter-rouge">__repr__()</code> method when implementing classes.</p>

<p>Make your code work with <code class="language-plaintext highlighter-rouge">for</code> loops as most standard libraries are designed to work with it.</p>

<p>Use context managers for resources that need to be cleaned up when done executing.</p>

<h2 id="chapter-5-functions">Chapter 5: Functions</h2>

<h3 id="positional-only-arguments">Positional-only arguments</h3>

<p>If you see a slash in a function signature <code class="language-plaintext highlighter-rouge">func(x, y, /)</code> that indicates that the arguments before slash can only be accepted by position.</p>

<p>In example below use of positional only argument prevents a clash with the seconds variable name.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">hours</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">seconds</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">minutes</span> <span class="o">+</span> <span class="mi">3600</span> <span class="o">*</span> <span class="n">hours</span>

<span class="n">after</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="function-application-and-parameter-passing">Function application and parameter passing</h3>

<p>Stylistically it is common for functions with side affects to return None.</p>

<p>If possible avoid using function with side affects.  They can lead to subtle errors that are hard to find.</p>

<p>Sometimes you already have data in a sequence or a mapping that you would like to pass to a function.  To do this you can use <code class="language-plaintext highlighter-rouge">*</code> and <code class="language-plaintext highlighter-rouge">**</code> in function invocations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="p">...</span>

<span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># Pass a sequence as arguments
</span><span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># Pass a mapping as keyword arguments
</span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'x'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">'y'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s">'z'</span><span class="p">:</span><span class="mi">3</span> <span class="p">}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="return-values">Return Values</h3>

<p>It may be a good idea to return a numbed tuple instead of a tuple if you are returning multiple items.  Named tuple acts just like regular tuple, but you can access elements by name.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="k">class</span> <span class="nc">ParseResult</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="s">'''
    Split text of the form name=val into (name, val)
    '''</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'='</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ParseResult</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">strip</span><span class="p">(),</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="error-handling">Error Handling</h3>

<p>As a general rule, exceptions are the more common way to handle an abnormal result, but exceptiosn are expensive if they frequently occur.  If you are writing code where performance matters returning None, Flase or -1 might be better.</p>

<h3 id="scoping-rules">Scoping Rules</h3>

<p>Using <code class="language-plaintext highlighter-rouge">global</code> is usually bad.  If you need to write a function that mutates state behind the scenes, consider using a class definition and modify state by mutating an instance or class variable instead.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">Config</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">13</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">nonlocal</code> is used to reference a local variable in an outer scope.  Fore example this example does not work…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'T-minus'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decrement</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>            <span class="c1"># Fails: UnboundLocalError
</span>    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">display</span><span class="p">()</span>
         <span class="n">decrement</span><span class="p">()</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">nonlocal</code> in example below fixes this…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'T-minus'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decrement</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>        <span class="c1"># Modifies the outer n
</span>    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">display</span><span class="p">()</span>
         <span class="n">decrement</span><span class="p">()</span>
</code></pre></div></div>

<p>Nested functions is not a common practice but can be useful to break down complex calculations into smaller parts and hiding internal implementation details.</p>

<h3 id="the-lambda-expression">The lambda expression</h3>

<p>The syntax for a <code class="language-plaintext highlighter-rouge">lambda</code> expression is <code class="language-plaintext highlighter-rouge">lambda args: expression</code> where <code class="language-plaintext highlighter-rouge">args</code> is a comma separated list or arguments and expression is an expression involving those arguments.  Code defined in <code class="language-plaintext highlighter-rouge">lambda</code> must be a valid expression.  Multiple statements, or non-expression statements such as <code class="language-plaintext highlighter-rouge">try</code> and <code class="language-plaintext highlighter-rouge">while</code> cannot appear in <code class="language-plaintext highlighter-rouge">lambda</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>            <span class="c1"># r gets 5
</span></code></pre></div></div>

<p>Use caution with <code class="language-plaintext highlighter-rouge">lambda</code> when it contains free variables (not specified as parameters).  In that scenario the value you will get is the latest value of the variable not the value at time of definition.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">g</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>       <span class="c1"># --&gt; prints 30 NOT 20
</span><span class="k">print</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>       <span class="c1"># --&gt; prints 30
</span></code></pre></div></div>

<p>If its important to capture the value of a variable at the tme of definition, use a default argument.  This works because default argument values are only evaluated at the time of function definition and thus would capture the current value of x.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">g</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>       <span class="c1"># --&gt; prints 20
</span><span class="k">print</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>       <span class="c1"># --&gt; prints 30
</span></code></pre></div></div>

<h3 id="higher-order-functions">Higher-order functions</h3>

<p>Higher order functions means that functions can be passed as arguments to other functions, placed in data structures, and returned by a function as a result.</p>

<p>A closure is a function along with an environment containing all the variables needed to execute the function body.  In example below the <code class="language-plaintext highlighter-rouge">name</code> variable is in a closure.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'Guido'</span>
    <span class="k">def</span> <span class="nf">greeting</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">greeting</span><span class="p">)</span>        <span class="c1"># Produces: 'Hello Guido'
</span>
<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="argument-passing-in-callback-functions">Argument passing in Callback Functions</h3>

<p>One challenge with callback functions is the passing of arguments for example.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="n">func</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s"> + </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s"> -&gt; </span><span class="si">{</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>    <span class="c1"># Fails: add() called immediately
</span></code></pre></div></div>

<p>In the above example the <code class="language-plaintext highlighter-rouge">add(2,3)</code> function runs immediately returning 5.  The after function then crashes 10 seconds later when it tries to execute 5().</p>

<p>One solution to this problem is to package up the computation into a zero-argument function using <code class="language-plaintext highlighter-rouge">lambda</code>.  A small zero-argument function like this is sometimes knows as a <code class="language-plaintext highlighter-rouge">thunk</code>.  Basically it is an expression that will be evaluated later when its eventually called.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div></div>

<p>An alternative to using <code class="language-plaintext highlighter-rouge">lambda</code> is to use <code class="language-plaintext highlighter-rouge">functools.partial()</code> to create a partially evaluated function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">partial()</code> creates a callable where one or more of the arguments have already been specified and are cached.  It can be a useful way to make nonconforming functions match expected calling signatures in callbacks and other applications.  Here are some more examples of using <code class="language-plaintext highlighter-rouge">partial()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>        <span class="c1"># Fix a=1, b=2
</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>                        <span class="c1"># func(1, 2, 3, 4)
</span><span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>                      <span class="c1"># func(1, 2, 10, 20)
</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>   <span class="c1"># Fix a=1, b=2, d=4
</span><span class="n">g</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                           <span class="c1"># func(1, 2, 3, 4)
</span><span class="n">g</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>                          <span class="c1"># func(1, 2, 10, 4)
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">partial()</code> and <code class="language-plaintext highlighter-rouge">lambda</code> can be used for similar purposes, but there is an important semantic distinction between the two techniques. With <code class="language-plaintext highlighter-rouge">partial()</code>, the arguments are evaluated and bound at the time the partial function is first defined. With a zero-argument <code class="language-plaintext highlighter-rouge">lambda</code>, the arguments are evaluated and bound when the <code class="language-plaintext highlighter-rouge">lambda</code> function actually executes later (the evaluation of everything is delayed).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="p">...</span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">20</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="p">()</span>    <span class="c1"># Uses current values of a, b
</span><span class="mi">30</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span><span class="p">()</span>    <span class="c1"># Uses initial values of a, b
</span><span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Another option for passing arguments to a callback function is to accept them separately as arguments to the outer calling function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>   <span class="c1"># Calls add(2, 3) after 10 seconds
</span></code></pre></div></div>

<p>Passing keyword arguments to <code class="language-plaintext highlighter-rouge">func()</code> is not supported.  This is by design.  One issue is that argument names may clash with argument names already in use.  Keyword arguments might also be reserved for specifying options to <code class="language-plaintext highlighter-rouge">after()</code> function itself.  For example…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'About to call'</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div></div>

<p>If you want <code class="language-plaintext highlighter-rouge">after()</code> function to accept keyword arguments a safe way to do it might be to use positional only arguments.  For example…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'About to call'</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">after</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="returning-results-form-callbacks">Returning results form callbacks</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div></div>

<p>The code above works but there are some corner cases to consider.</p>

<p>One issue is exception handling.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">after</span><span class="p">(</span><span class="s">"1"</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>   <span class="c1"># Fails: TypeError (integer is expected)
</span><span class="n">after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="s">"2"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>   <span class="c1"># Fails: TypeError (can't concatenate int to str)
</span></code></pre></div></div>

<p>Above, a <code class="language-plaintext highlighter-rouge">TypeError</code> is raised in both cases, but for different reasons.  One way to handle that is to package errors from the callback in a different way.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CallbackError</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CallbackError</span><span class="p">(</span><span class="s">'Callback function failed'</span><span class="p">)</span> <span class="k">from</span> <span class="n">err</span>

<span class="c1"># used like this.
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">after</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">except</span> <span class="n">CallbackError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"It failed. Reason"</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">__cause__</span><span class="p">)</span>

</code></pre></div></div>

<p>Another option is to package the result of the callback function into some kind of result instance that holds both a value and an error.  Fore example define a class like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">after</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">except</span> <span class="n">CallbackError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"It failed. Reason"</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">__cause__</span><span class="p">)</span>

<span class="c1"># Use the class to return results from after()
</span>
<span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">err</span><span class="p">)</span>

<span class="c1"># Example use:
</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">result</span><span class="p">())</span>            <span class="c1"># Prints 5
</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">after</span><span class="p">(</span><span class="s">"1"</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>    <span class="c1"># Immediately raises TypeError. Bad sleep() arg.
</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="s">"2"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>    <span class="c1"># Returns a "Result"
</span><span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">result</span><span class="p">())</span>            <span class="c1"># Raises TypeError
</span></code></pre></div></div>

<h3 id="decorators">Decorators</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Calling'</span><span class="p">,</span> <span class="n">func</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">call</span>

<span class="c1"># Example use
</span><span class="o">@</span><span class="n">trace</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</code></pre></div></div>

<p>The problem with above example is that it hides metadata of the wrapped function such as the function name, doc string, and type hints.  This is why you want to use <code class="language-plaintext highlighter-rouge">functools.wraps</code>  The <code class="language-plaintext highlighter-rouge">@wraps</code> decorator copies various function metadata to the replacement function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Calling'</span><span class="p">,</span> <span class="n">func</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">call</span>
</code></pre></div></div>

<p>When decorators are applied they must appear on their own line and immediately prior to the function definition.  More than one decorator can be applied.  The order in which decorators are applied matters as sometimes decorator may return object different than a normal function and if outermost decorator is not expecting this things may break.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">decorator1</span>
<span class="o">@</span><span class="n">decorator2</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p>You can pass arguments to decorators.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorate</span>

<span class="o">@</span><span class="n">trace</span><span class="p">(</span><span class="s">"You called {func.__name__}"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p>Decorators don’t need to replace the original function.  You can just perform an action such as registration.  Example below registers action handlers.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Event handler decorator
</span><span class="n">_event_handlers</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">def</span> <span class="nf">eventhandler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">_event_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
        <span class="k">return</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">register_function</span>

<span class="o">@</span><span class="n">eventhandler</span><span class="p">(</span><span class="s">'BUTTON'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_button</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
     <span class="p">...</span>
<span class="o">@</span><span class="n">eventhandler</span><span class="p">(</span><span class="s">'RESET'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_reset</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
     <span class="p">...</span>
</code></pre></div></div>

<h3 id="map-filter-and-reduce">Map filter and reduce</h3>

<p>In Python list cmprehension and generator expressiosn can provide this functionality.</p>

<p>Python provides a build in <code class="language-plaintext highlighter-rouge">map()</code> function that is the same as mapping a function with a generator expression</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">squares</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">nums</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">squares</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<p>The built in <code class="language-plaintext highlighter-rouge">filter()</code> function creates a generator that filters values:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nums</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<p>If you want to accumulate or reduce values, you can use <code class="language-plaintext highlighter-rouge">functools.reduce()</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>
<span class="n">total</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">nums</span><span class="p">)</span>
</code></pre></div></div>

<p>In its general form <code class="language-plaintext highlighter-rouge">reduce()</code> accepts two arguments an iterable and an initial value.  Some more exampels…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">total</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">nums</span><span class="p">)</span>         <span class="c1"># 15
</span><span class="n">product</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">nums</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>    <span class="c1"># 120
</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">nums</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="c1"># (((((None, 1), 2), 3), 4), 5)
</span></code></pre></div></div>

<p>In practice using reduce may be confusing and there are faster options for common use cases such as <code class="language-plaintext highlighter-rouge">sum()</code>, <code class="language-plaintext highlighter-rouge">min()</code>, <code class="language-plaintext highlighter-rouge">max()</code>.</p>

<h3 id="function-introspection-attributes-and-signatures">Function introspection, attributes and signatures</h3>

<p>Some common functions introspection variables are</p>

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__name__</code></td>
      <td>Function name</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__qualname__</code></td>
      <td>Fully qualified name (if nested)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__module__</code></td>
      <td>Name of module in which defined</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__doc__</code></td>
      <td>Document String</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__annotations__</code></td>
      <td>Type hints</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__globals__</code></td>
      <td>Dictionary that is global namespace</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__closure__</code></td>
      <td>Closure variables (if any)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f.__code__</code></td>
      <td>Underlying code object</td>
    </tr>
  </tbody>
</table>

<p>if you want to know more about a function’s parameters, you can obtain its signature using <code class="language-plaintext highlighter-rouge">inspect.signature()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">inspect</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="c1"># Print out the signature in a nice form
</span><span class="k">print</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>  <span class="c1"># Produces (x: int, y: float, debug=False) -&gt; float
</span>
<span class="c1"># Get a list of argument names
</span><span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">parmeters</span><span class="p">))</span>   <span class="c1"># Produces [ 'x', 'y', 'debug']
</span>
<span class="c1"># Iterate over the parameters and print various metadata
</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sig</span><span class="p">.</span><span class="n">parameters</span><span class="p">.</span><span class="n">values</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'annotation'</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">annotation</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'kind'</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'default'</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">default</span><span class="p">)</span>
</code></pre></div></div>

<p>Here is how you would check if two functions have the same signtures.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">assert</span> <span class="n">inspect</span><span class="p">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func1</span><span class="p">)</span> <span class="o">==</span> <span class="n">inspect</span><span class="p">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func2</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="environment-insepction">Environment Insepction</h3>

<p>Functions can inspect their executino environment using the built in functions <code class="language-plaintext highlighter-rouge">globals()</code> and <code class="language-plaintext highlighter-rouge">locals()</code>.</p>

<p><code class="language-plaintext highlighter-rouge">globals()</code> returns the dictionary that’s serving as the global namespace.  This is the same thing as <code class="language-plaintext highlighter-rouge">func.__globals__</code> attribute.  This is usually the same dictionary that’s holding the contents of the enclosing module.</p>

<p><code class="language-plaintext highlighter-rouge">locals()</code> returns a dictionary containing the values of all local and closure variables.  This dictinary is not the actual data structure used to hold these variables.  Local variables can come from outer functions via closures or be defined internally.  Changing an item in the <code class="language-plaintext highlighter-rouge">locals()</code> dictionary hav no effect on the underlying variable.</p>

<p>A function can obtain its own stack frame using <code class="language-plaintext highlighter-rouge">inspect.currentframe()</code>. A function can obtain the stack frame of its caller by following the stack trace through f.f_back attributes on the frame</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">inspect</span>

<span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="n">grok</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">10</span>

    <span class="c1"># outputs: {'a':5, 'b':50 }
</span>    <span class="k">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">.</span><span class="n">currentframe</span><span class="p">().</span><span class="n">f_locals</span><span class="p">)</span>

    <span class="c1"># outputs: {'x':2, 'y':3, 'z':5 }
</span>    <span class="k">print</span><span class="p">(</span><span class="n">inspect</span><span class="p">.</span><span class="n">currentframe</span><span class="p">().</span><span class="n">f_back</span><span class="p">.</span><span class="n">f_locals</span><span class="p">)</span>

<span class="n">spam</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<p>Sometimes you will see stack frames obtained using the <code class="language-plaintext highlighter-rouge">sys._getframe()</code> function instead.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">f_locals</span><span class="p">)</span>    <span class="c1"># myself
</span>    <span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">f_locals</span><span class="p">)</span>    <span class="c1"># my caller
</span></code></pre></div></div>

<p>The below attributes can be usefull for inspecting frames.</p>

<table>
  <tbody>
    <tr>
      <td>Attribute</td>
      <td>Desriptions</td>
    </tr>
    <tr>
      <td>f.f_back</td>
      <td>Previous stack frame (toward the caller)</td>
    </tr>
    <tr>
      <td>f.f_code</td>
      <td>Code object being executed</td>
    </tr>
    <tr>
      <td>f.f_locals</td>
      <td>Dictionary of local variables (locals())</td>
    </tr>
    <tr>
      <td>f.f_globals</td>
      <td>Dictionary used for global variables</td>
    </tr>
    <tr>
      <td>f.f_builtins</td>
      <td>Dictionary used for built in names</td>
    </tr>
    <tr>
      <td>f.f_lineno</td>
      <td>Line number</td>
    </tr>
    <tr>
      <td>f.f_lasti</td>
      <td>Current instruction.  This is an index into the bytecode string of f_code</td>
    </tr>
    <tr>
      <td>f.f_trace</td>
      <td>Function called at start of each source code line</td>
    </tr>
  </tbody>
</table>

<p>Below is a debug function that lets you view the values of the selected variables of the caller:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">ChainMap</span>

<span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="o">*</span><span class="n">varnames</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">.</span><span class="n">currentframe</span><span class="p">().</span><span class="n">f_back</span>
    <span class="nb">vars</span> <span class="o">=</span> <span class="n">ChainMap</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">f_locals</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">f_globals</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">f</span><span class="p">.</span><span class="n">f_code</span><span class="p">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">f</span><span class="p">.</span><span class="n">f_lineno</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'    </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> = </span><span class="si">{</span><span class="nb">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="c1"># Example use
</span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="n">debug</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span><span class="s">'y'</span><span class="p">)</span>  <span class="c1"># Shows x and y along with file/line
</span>    <span class="k">return</span> <span class="n">z</span>
</code></pre></div></div>

<h3 id="asynchronous-functions-and-await">Asynchronous Functions and await</h3>

<p>An asynchronous function, or coroutine is defined by prefacing a normal function definition with the keyword <code class="language-plaintext highlighter-rouge">async</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<p>This funciton does not execute in the usual way, If you call the function it does not run, but you get an instance of a coroutine object in return.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">greeting</span><span class="p">(</span><span class="s">'Guido'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">coroutine</span> <span class="nb">object</span> <span class="n">greeting</span> <span class="n">at</span> <span class="mh">0x104176dc8</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>To make the function run it must be executed under the supervision of other code.  A common option is <code class="language-plaintext highlighter-rouge">asyncio</code> as shown below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">asyncio</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">greeting</span><span class="p">(</span><span class="s">'Guido'</span><span class="p">))</span>
<span class="n">Hello</span> <span class="n">Guido</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Some kind of manager code or library is alwasy requried for the execution of an <code class="language-plaintext highlighter-rouge">async</code> function.  It does not have to be <code class="language-plaintext highlighter-rouge">asyncio</code>.</p>

<p>Aside from being managed async Python functions evaluate in the same way as regulear python functions.  If you want to return a value you do it in the usual manner and the value is returned by the outer <code class="language-plaintext highlighter-rouge">run()</code> as in example below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">make_greeting</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">'Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">asyncio</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">make_greeting</span><span class="p">(</span><span class="s">'Paula'</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="s">'Hello Paula'</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Async functions can call other async function using the <code class="language-plaintext highlighter-rouge">await</code> keyword.  Use of <code class="language-plaintext highlighter-rouge">await</code> is only valid within an enclosing <code class="language-plaintext highlighter-rouge">async</code> function definition.  Its also required to make functions execute.  If you leave off the <code class="language-plaintext highlighter-rouge">await</code> the code breaks.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">make_greeting</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">'Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">'</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'Paula'</span><span class="p">,</span> <span class="s">'Thomas'</span><span class="p">,</span> <span class="s">'Lewis'</span><span class="p">]:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_greeting</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="c1"># Run it. Will see greetings for Paula, Thomas, and Lewis
</span><span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></div>

<p>The need for use of <code class="language-plaintext highlighter-rouge">await</code> hints at a general uage issue with asyncchronous functions.  Namely their different evaulation model prevents them from being used in combination with other parts of Python.  Its never possbile to call an async function from a non async function.</p>

<p>Combining async and non async functions in the same application is a complex topic that involves use of higher order functions, callbacks, and decorators.  In most cases support for async fucntions has to be built in as a special case.  Python does this for the context manager protocol.  An asnchroous context manager can be defined using <code class="language-plaintext highlighter-rouge">__aenter__()</code> and <code class="language-plaintext highlighter-rouge">__aexit__()</code> methods on a calss like below.  A calss can similarly define an async iterator by defining methods <code class="language-plaintext highlighter-rouge">__aiter__()</code> and <code class="language-plaintext highlighter-rouge">__anext__()</code> which are used by the <code class="language-plaintext highlighter-rouge">async for</code> statement which also can only appear inside an async function.</p>

<p>Note that these methods are async functions and can thus execute other async functions using <code class="language-plaintext highlighter-rouge">await</code>.  To use such a manger you must use the special <code class="language-plaintext highlighter-rouge">async with</code> syntax which is only legal in an async function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AsyncManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c1"># Example use
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncManager</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
         <span class="k">await</span> <span class="n">m</span><span class="p">.</span><span class="n">yow</span><span class="p">()</span>

<span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="chapter-6-generators">Chapter 6: Generators</h2>

<h3 id="generators-and-yield">Generators and yield</h3>

<p>If a funtion uses the <code class="language-plaintext highlighter-rouge">yield</code> keyword that means that it defines an object known as a generator.  The primary use of a generator is to produce values for use in iteration</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
     <span class="k">print</span><span class="p">(</span><span class="s">'Counting down from'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
     <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">yield</span> <span class="n">n</span>
          <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="c1"># Example use
</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'T-minus'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<p>If you call the above function notice that its code does not start executing.  Instead a genrator object is created.  The generator object only starts executing the function when you start iterating on it, or when you call <code class="language-plaintext highlighter-rouge">next()</code> on it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">countdown</span> <span class="n">at</span> <span class="mh">0x105f73740</span>
<span class="o">&gt;&gt;&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">Counting</span> <span class="n">down</span> <span class="k">from</span> <span class="mi">10</span>
<span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
 <span class="mi">9</span>
</code></pre></div></div>

<p>When <code class="language-plaintext highlighter-rouge">next()</code> is called the generator function executes statemetns until it reaches a <code class="language-plaintext highlighter-rouge">yield</code> statement.  The <code class="language-plaintext highlighter-rouge">yield</code> statement retursn a result, at which point execution of the function is suspended untill <code class="language-plaintext highlighter-rouge">next()</code> is invoked gain.  While its suspended the function retains all its local variables and execution environment.  When resumed it continues with the code following the the <code class="language-plaintext highlighter-rouge">yield</code> statement.</p>

<p><code class="language-plaintext highlighter-rouge">next()</code> is a shorthand for invoking the <code class="language-plaintext highlighter-rouge">__next__()</code> method on a generator.</p>

<p>You normally would not call <code class="language-plaintext highlighter-rouge">next()</code> on a generator but use <code class="language-plaintext highlighter-rouge">for</code> statement.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
     <span class="n">statements</span>

<span class="n">a</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div></div>

<p>A generator function produces items until it returns by reaching the end of the function or by suing a <code class="language-plaintext highlighter-rouge">return</code> statement.  This raises a <code class="language-plaintext highlighter-rouge">StopIteration</code> exception that terminates a <code class="language-plaintext highlighter-rouge">for</code> loop.  If a generator function returns a non <code class="language-plaintext highlighter-rouge">None</code> value it is attached to the <code class="language-plaintext highlighter-rouge">StopIteration</code> exceiption.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">yield</span> <span class="mi">37</span>
    <span class="k">return</span> <span class="mi">42</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">func</span> <span class="n">at</span> <span class="mh">0x10b7cd480</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="mi">37</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="nb">StopIteration</span><span class="p">:</span> <span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>To collect the value you need to catch the <code class="language-plaintext highlighter-rouge">StopIteration</code> exception.  Normally generator functions don’t return values.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">func</span> <span class="n">at</span> <span class="mh">0x10b7cd480</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="mi">37</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="nb">StopIteration</span><span class="p">:</span> <span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>A subtle issue with generators is if the for loop iterating over a genrator is exited pre maturely (with a <code class="language-plaintext highlighter-rouge">break</code> for example) the genetrator will stay in memory.  For this reason you need to have cleanup code in a <code class="language-plaintext highlighter-rouge">try/finally</code> when writing generators.  Generators are guaranteed to run the finally block which is executed when the abandoned genrator is garbage collected.  The same applies to context managers finally code will execute when garbage collected.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Counting down from'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
         <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="k">yield</span> <span class="n">n</span>
              <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">finally</span><span class="p">:</span>
         <span class="k">print</span><span class="p">(</span><span class="s">'Only made it to'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="restartable-generators">Restartable generators</h3>

<p>Normally a generator functione executes only once.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="s">'T-minus'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">T</span><span class="o">-</span><span class="n">minus</span> <span class="mi">3</span>
<span class="n">T</span><span class="o">-</span><span class="n">minus</span> <span class="mi">2</span>
<span class="n">T</span><span class="o">-</span><span class="n">minus</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="s">'T-minus'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="p">...</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>If you want an object that allows repeated iteration, define it as a class and make the <code class="language-plaintext highlighter-rouge">__iter__()</code> method a genrator.  This works because each time you iterate, a fresh generator is created by <code class="language-plaintext highlighter-rouge">__iter__()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">countdown</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">start</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">n</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></div>

<h3 id="generator-delegation">Generator delegation</h3>

<p>A features of generator is that a function involing <code class="language-plaintext highlighter-rouge">yield</code> never executes by itself.  It needs to be driving by other code.  This makes it difficult to wrinte library functions involving <code class="language-plaintext highlighter-rouge">yield</code> becaue calling a generator function is not enough to make it execute.  To address this a <code class="language-plaintext highlighter-rouge">yield from</code> statement can be used.</p>

<p><code class="language-plaintext highlighter-rouge">yield from</code> effectively delegates the iteration process to an outer iteration.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">countup</span><span class="p">(</span><span class="n">stop</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">stop</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">up_and_down</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">yield</span> <span class="k">from</span> <span class="n">countup</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">yield</span> <span class="k">from</span> <span class="n">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">up_and_down</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">' '</span><span class="p">)</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Without the <code class="language-plaintext highlighter-rouge">yield from</code> you would need to drive the iteration yourself as in the example below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">up_and_down</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">' '</span><span class="p">)</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">yield from</code> is especially useful when writing code that must recursively iterate though nested iterables.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">yield</span> <span class="k">from</span> <span class="n">flatten</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="mi">8</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="p">...</span>    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">' '</span><span class="p">)</span>
<span class="p">...</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h3 id="using-generators-in-practice">Using Generators in Practice</h3>

<p>Generators are particularly effective at structuring varios data handling problems related to pipeline and workflows.</p>

<p>One usefull applications is restructuring code consisting of deeply nested for loops and conditionals.  Example below searches directory of Python files for comments containign the word ‘spam’.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="p">.</span><span class="n">Path</span><span class="p">(</span><span class="s">'.'</span><span class="p">).</span><span class="n">rglob</span><span class="p">(</span><span class="s">'*.py'</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">path</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'rt'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="s">'.*(#.*)$'</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                     <span class="n">comment</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                     <span class="k">if</span> <span class="s">'spam'</span> <span class="ow">in</span> <span class="n">comment</span><span class="p">:</span>
                         <span class="k">print</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</code></pre></div></div>

<p>Below is the alternate version using generators.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">get_paths</span><span class="p">(</span><span class="n">topdir</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="p">.</span><span class="n">Path</span><span class="p">(</span><span class="n">topdir</span><span class="p">).</span><span class="n">rglob</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">path</span>

<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">path</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'rt'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin-1'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
             <span class="k">yield</span> <span class="nb">file</span>

<span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">yield</span> <span class="k">from</span> <span class="nb">file</span>

<span class="k">def</span> <span class="nf">get_comments</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="s">'.*(#.*)$'</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_matching</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">substring</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">substring</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">substring</span><span class="p">)</span>

<span class="n">paths</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">'*.py'</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">pypaths</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">pyfiles</span><span class="p">)</span>
<span class="n">comments</span> <span class="o">=</span> <span class="n">get_comments</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="n">print_matching</span><span class="p">(</span><span class="n">comments</span><span class="p">,</span> <span class="s">'spam'</span><span class="p">)</span>
</code></pre></div></div>

<p>Generators are also usefull for altering the normal evaluation rules fo function application.  Below is an implementaiton of the flatten code we saw above but here we don’t need to worry about the Python recursion limit.  This implementaiton builds an internal stack of iterators and thus is not subject to Python’s recursion limit.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">iter</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">]</span>
    <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">item</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="enhanced-generatos-and-yield-expressions">Enhanced Generatos and yield expressions</h3>

<p>Inside a genrator a <code class="language-plaintext highlighter-rouge">yield</code> can be used as an expression that appears on the right side of an operator.  A functiont hat uses <code class="language-plaintext highlighter-rouge">yield</code> in this manner is known as an “enhanced genrator”.  This is still creating a generator but the usage is different.  Istead of producing values, it executes in response to values sent to it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">receiver</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Ready to receive'</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
          <span class="n">n</span> <span class="o">=</span> <span class="k">yield</span>
          <span class="k">print</span><span class="p">(</span><span class="s">'Got'</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>        <span class="c1"># Advances to the first yield
</span><span class="n">Ready</span> <span class="n">to</span> <span class="n">receive</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Got</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Got</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">'Hello'</span><span class="p">)</span>
<span class="n">Got</span> <span class="n">Hello</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>As written the above runs indefinitly.  The <code class="language-plaintext highlighter-rouge">close()</code> method can be used to shut down the generator.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="nb">StopIteration</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Exceptions can be raised inside genrator using <code class="language-plaintext highlighter-rouge">throw(ty [,val,tb]])</code> where <code class="language-plaintext highlighter-rouge">ty</code> is the exception type, <code class="language-plaintext highlighter-rouge">val</code> is the exception argument (or tuple of argumetns) and <code class="language-plaintext highlighter-rouge">tb</code> isa n optional tracebck.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>
<span class="n">Ready</span> <span class="n">to</span> <span class="n">receive</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">throw</span><span class="p">(</span><span class="nb">RuntimeError</span><span class="p">,</span>  <span class="s">"Dead"</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s">"receiver.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">14</span><span class="p">,</span> <span class="ow">in</span> <span class="n">receiver</span>
    <span class="n">n</span> <span class="o">=</span> <span class="k">yield</span>
<span class="nb">RuntimeError</span><span class="p">:</span> <span class="n">Dead</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h2 id="chapter-7-classea-and-object-oriented-programming">Chapter 7: Classea and Object Oriented Programming</h2>

<h3 id="attribute-access">Attribute access</h3>

<p>If you wanted to look up an attribute that may or may not exist, you could do this (working on classes here)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Guido'</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">'balance'</span><span class="p">,</span> <span class="s">'unknown'</span><span class="p">)</span>
<span class="mf">1000.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">'creation_date'</span><span class="p">,</span> <span class="s">'unknown'</span><span class="p">)</span>
<span class="s">'unknown'</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>When you access a method as an attribute you get an object known as a <strong>bound method</strong>.  A bound method is an object that contains both an instance (the <code class="language-plaintext highlighter-rouge">self</code>) and the function that implements the bound method.  When you call a bound method by adding parenthesis and arguments, it executes the method passing the attached intances as the first argument.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Guido'</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">withdraw</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span>
<span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">Account</span><span class="p">.</span><span class="n">withdraw</span> <span class="n">of</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Guido'</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="n">Account</span><span class="p">(</span><span class="s">'Guido'</span><span class="p">,</span> <span class="mf">900.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h3 id="inheritence">Inheritence</h3>

<p>Occasionally, a derived class would implement a method but also need to call the original implementation.  A method can explicitly call the orignal method using <code class="language-plaintext highlighter-rouge">super()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EvilAccount</span><span class="p">(</span><span class="n">Account</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
           <span class="k">return</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="nb">super</span><span class="p">().</span><span class="n">inquiry</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="k">return</span> <span class="nb">super</span><span class="p">().</span><span class="n">inquiry</span><span class="p">()</span>
</code></pre></div></div>

<p>Its less common but you can use this technique for setting attributes as well.  Note that is you are implementing your own <code class="language-plaintext highlighter-rouge">__init__()</code> method on a child class it is the responsibility of the new <code class="language-plaintext highlighter-rouge">__init__()</code> method to call the partent one with <code class="language-plaintext highlighter-rouge">super().__init__()</code> if you don’t do this you will end up with a partially initialized object.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EvilAccount</span><span class="p">(</span><span class="n">Account</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
           <span class="k">return</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="nb">super</span><span class="p">().</span><span class="n">inquiry</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="k">return</span> <span class="nb">super</span><span class="p">().</span><span class="n">inquiry</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="dynamic-binding-and-duck-typing">Dynamic binding and duck typing</h3>

<p><strong>Duck typing</strong> means that if you call <code class="language-plaintext highlighter-rouge">obj.name</code> Python will look for a name attribute without caring what type the object is.  What methods an object has in Pyton is used over what type of object somethign is.</p>

<h3 id="the-danger-of-inheriting-from-built-in-types">The danger of inheriting from built in types</h3>

<p>Python’s built in types aren’t implemented like normal Python classes.  They are implemented in C.  For exaple <code class="language-plaintext highlighter-rouge">dict.update()</code> directly manipulates the dictioanry data without ever routing through the dunder method.</p>

<p>The <code class="language-plaintext highlighter-rouge">collections</code> module has speical classes <code class="language-plaintext highlighter-rouge">UserDict</code>, <code class="language-plaintext highlighter-rouge">UserList</code>, and <code class="language-plaintext highlighter-rouge">UserString</code> that can be used to make safe subclasses of <code class="language-plaintext highlighter-rouge">dict</code>, <code class="language-plaintext highlighter-rouge">list</code>, and <code class="language-plaintext highlighter-rouge">str</code> types.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EvilAccount</span><span class="p">(</span><span class="n">Account</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
           <span class="k">return</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="nb">super</span><span class="p">().</span><span class="n">inquiry</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="k">return</span> <span class="nb">super</span><span class="p">().</span><span class="n">inquiry</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">udict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Guido'</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">37</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'Blue'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span>
<span class="p">{</span><span class="s">'NAME'</span><span class="p">:</span> <span class="s">'Guido'</span><span class="p">,</span> <span class="s">'NUM'</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span> <span class="s">'COLOR'</span><span class="p">:</span> <span class="s">'Blue'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">udict</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">v</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'BDFL'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">v</span>
<span class="p">{</span><span class="s">'NAME'</span><span class="p">:</span> <span class="s">'Guido'</span><span class="p">,</span> <span class="s">'NUM'</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span> <span class="s">'COLOR'</span><span class="p">:</span> <span class="s">'Blue'</span><span class="p">,</span> <span class="s">'TITLE'</span><span class="p">:</span> <span class="s">'BDFL'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h3 id="class-variables-and-methods">Class variables and methods</h3>

<p>In a class definition, all functiosn are assumed to operate on an instance which is alwasy passed as the first parameter <code class="language-plaintext highlighter-rouge">self</code>.  However the class itself is also an object that can carry state and be manipulated as well.  Class variables are defined outside the normal <code class="language-plaintext highlighter-rouge">__init__()</code> method and to modify them use the class not the <code class="language-plaintext highlighter-rouge">self</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
    <span class="n">num_accounts</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
        <span class="n">Account</span><span class="p">.</span><span class="n">num_accounts</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">).</span><span class="n">__name__</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">owner</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">balance</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">)'</span>

    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">deposit</span><span class="p">(</span><span class="o">-</span><span class="n">amount</span><span class="p">)</span>    <span class="c1"># Must use self.deposit()
</span>
    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">balance</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Guido'</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Eva'</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="p">.</span><span class="n">num_accounts</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Its unusual but class variables can also be accessed witht he instance.  This works becaue attribute lookup on instnaces checks the associated class if there’s not matching attribute on the instance itself.  This is the same mechanism by which Python normally finds methods.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">num_accounts</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Ben'</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="p">.</span><span class="n">num_accounts</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">num_accounts</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Its also possible to define a <strong>class method</strong>.  A method applied to the class itself, not instances.  A common use of class methods is to define alternate instance constructors.  For example if you need to create Account instances from a legacy input format.  The first argument to a class method is alwasy the class itself and by convetnion its called <code class="language-plaintext highlighter-rouge">cls</code>.  If the class method is creating a new instance you need to take steps to do so.  In example below the call to<code class="language-plaintext highlighter-rouge">cls(...,...)</code> is same as calling <code class="language-plaintext highlighter-rouge">Account(...,...)</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">import</span> <span class="n">XML</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">XML</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">'owner'</span><span class="p">),</span>
                   <span class="nb">float</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">'amount'</span><span class="p">)))</span>

<span class="c1"># Example use
</span>
<span class="n">data</span> <span class="o">=</span> <span class="s">'''
&lt;account&gt;
    &lt;owner&gt;Guido&lt;/owner&gt;
    &lt;amount&gt;1000.0&lt;/amount&gt;
&lt;/account&gt;
'''</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">.</span><span class="n">from_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<p>Class variables and class methods are sometimes used together to con-figure how instances operte.  Configuration via class variables and inheritance like this is a common tool for adjusting the behavior of instances. The use of class methods is critical to making it work since they ensure that the proper kind of object gets created.  Alternate construction of instances is, by far, the most common use of class methods. A common naming convention for such methods is to include the word <code class="language-plaintext highlighter-rouge">from_</code> as a prefix, such as <code class="language-plaintext highlighter-rouge">from_timestamp()</code>. You will see this naming convention used in class methods throughout the standard library and in third-party packages. For example, dictionaries have a class method for creating a preinitialized dictionary from a set of keys</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
    <span class="n">datefmt</span> <span class="o">=</span> <span class="s">'{year}-{month:02d}-{day:02d}'</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">datefmt</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">year</span><span class="p">,</span>
                                   <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">month</span><span class="p">,</span>
                                   <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">day</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">from_timestamp</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">tm</span><span class="p">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">tm</span><span class="p">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">tm</span><span class="p">.</span><span class="n">tm_mday</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">today</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">from_timestamp</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">MDYDate</span><span class="p">(</span><span class="n">Date</span><span class="p">):</span>
    <span class="n">datefmt</span> <span class="o">=</span> <span class="s">'{month}/{day}/{year}'</span>

<span class="k">class</span> <span class="nc">DMYDate</span><span class="p">(</span><span class="n">Date</span><span class="p">):</span>
    <span class="n">datefmt</span> <span class="o">=</span> <span class="s">'{day}/{month}/{year}'</span>

<span class="c1"># Example
</span><span class="n">a</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>       <span class="c1"># 1967-04-09
</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">MDYDate</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>       <span class="c1"># 4/9/1967
</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">DMYDate</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>      <span class="c1"># 9/4/1967
</span></code></pre></div></div>

<p>One caution about class methods is that Python does not manage them in a namespace separate from the instance methods. As a result, they can still be invoked on an instance. For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">today</span><span class="p">()</span>          <span class="c1"># Calls Date.now(Date)
</span></code></pre></div></div>

<p>This is potentially quite confusing because a call to <code class="language-plaintext highlighter-rouge">d.today()</code> doesn’t really have anything to do with the instance <code class="language-plaintext highlighter-rouge">d</code>. Yet, you might see <code class="language-plaintext highlighter-rouge">today()</code> listed as a valid method on <code class="language-plaintext highlighter-rouge">Date</code> instances in your IDE and in documentation.</p>

<h3 id="static-methods">Static Methods</h3>

<p>You can use static methods to organize a bundle of methods into a single namespace (the class).  Below is an excample of account where you can use the <code class="language-plaintext highlighter-rouge">policy</code> to choose which set of methods is applied.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StandardPolicy</span><span class="p">:</span>
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="n">account</span><span class="p">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="n">account</span><span class="p">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">account</span><span class="p">.</span><span class="n">balance</span>

<span class="k">class</span> <span class="nc">EvilPolicy</span><span class="p">(</span><span class="n">StandardPolicy</span><span class="p">):</span>
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="n">account</span><span class="p">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="mf">0.95</span><span class="o">*</span><span class="n">amount</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
           <span class="k">return</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="n">account</span><span class="p">.</span><span class="n">balance</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="k">return</span> <span class="n">account</span><span class="p">.</span><span class="n">balance</span>

<span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="n">StandardPolicy</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">policy</span> <span class="o">=</span> <span class="n">policy</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">'Account(</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">policy</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">owner</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">balance</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">)'</span>

    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="data-encapsulation-and-private-attributes">Data encapsulation and private attributes</h3>

<p>Names starting with underscoe <code class="language-plaintext highlighter-rouge">_</code> indicate internal implementation.  This is convention only nothing will stop user from accessing the method or variable.</p>

<p>If you really want to make an attriubte private have the name start with double underscores <code class="language-plaintext highlighter-rouge">__</code>.  All names such as <code class="language-plaintext highlighter-rouge">__name</code> are automatically renamed into a new name of the form <code class="language-plaintext highlighter-rouge">_Classname__name</code>.  This ensures that private names used in a superclass won’t be overwriten by identical names in a child class.  Be aware that name mangling does not occur in functions such as <code class="language-plaintext highlighter-rouge">getattr()</code>, <code class="language-plaintext highlighter-rouge">hasattr()</code>, <code class="language-plaintext highlighter-rouge">setattr()</code>, or <code class="language-plaintext highlighter-rouge">delattr()</code> where the attribute name is specified as a string. For these functions, you would need to explicitly use the mangled name such as <code class="language-plaintext highlighter-rouge">_Classname__name</code> to access the attribute.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__x</span> <span class="o">=</span> <span class="mi">3</span>        <span class="c1"># Mangled to self._A__x
</span>
    <span class="k">def</span> <span class="nf">__spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>       <span class="c1"># Mangled to _A__spam()
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'A.__spam'</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">__x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__spam</span><span class="p">()</span>       <span class="c1"># Only calls A.__spam()
</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">A</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__x</span> <span class="o">=</span> <span class="mi">37</span>       <span class="c1"># Mangled to self._B__x
</span>
    <span class="k">def</span> <span class="nf">__spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>       <span class="c1"># Mangled to _B__spam()
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'B.__spam'</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">__x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__spam</span><span class="p">()</span>       <span class="c1"># Calls B.__spam()
</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">bar</span><span class="p">()</span>
<span class="n">A</span><span class="p">.</span><span class="n">__spam</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">grok</span><span class="p">()</span>
<span class="n">B</span><span class="p">.</span><span class="n">__spam</span> <span class="mi">37</span>
<span class="o">&gt;&gt;&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">vars</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span> <span class="s">'_A__x'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'_B__x'</span><span class="p">:</span> <span class="mi">37</span> <span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">_A__spam</span><span class="p">()</span>
<span class="n">A</span><span class="p">.</span><span class="n">__spam</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">_B__spam</span>
<span class="n">B</span><span class="p">.</span><span class="n">__spam</span> <span class="mi">37</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h3 id="properties">Properties</h3>

<p>Python places no runtime restrictions on attribute values or types.  Such enforcement is possible if you put an attribute under the manage of a so called <strong>property</strong>.  A property is a special kind of attribute that intercepts attribute access and handles it via user-defined methods.  These methods have complete freedeom to manage the attribute as they see fit.  A critical feature of properties is that the associated name such as <code class="language-plaintext highlighter-rouge">owner</code> in below example becomes “magical”.  That is, any use of that attribute automatically routes though the getter/setter methods.  Since each access to a property attribute automatically invokes a method, the actual value needs to be stored under a different name. This is why _owner is used inside the getter and setter methods. You can’t use owner as the storage location because doing so would cause infinite recursion.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">string</span>
<span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_balance</span> <span class="o">=</span> <span class="n">balance</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_owner</span>

    <span class="o">@</span><span class="n">owner</span><span class="p">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="s">'Expected str'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_uppercase</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'Must be uppercase ASCII'</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'Must be 10 characters or less'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">value</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'GUIDO'</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="s">'EVA'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="p">...</span>
<span class="nb">TypeError</span><span class="p">:</span> <span class="n">Expected</span> <span class="nb">str</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="s">'Carol'</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="p">...</span>
<span class="nb">ValueError</span><span class="p">:</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">uppercase</span> <span class="n">ASCII</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="s">'RENÉE'</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="p">...</span>
<span class="nb">ValueError</span><span class="p">:</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">uppercase</span> <span class="n">ASCII</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="s">'RAMAKRISHNAN'</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="p">...</span>
<span class="nb">ValueError</span><span class="p">:</span> <span class="n">Must</span> <span class="n">be</span> <span class="mi">10</span> <span class="n">characters</span> <span class="ow">or</span> <span class="n">less</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Below is how you implement property getter, setter and deleter</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Getting'</span><span class="p">)</span>

    <span class="o">@</span><span class="n">attr</span><span class="p">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Setting'</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="o">@</span><span class="n">attr</span><span class="p">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Deleting'</span><span class="p">)</span>

<span class="c1"># Example
</span><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<span class="n">s</span><span class="p">.</span><span class="n">attr</span>         <span class="c1"># Getting
</span><span class="n">s</span><span class="p">.</span><span class="n">attr</span> <span class="o">=</span> <span class="mi">13</span>    <span class="c1"># Setting
</span><span class="k">del</span> <span class="n">s</span><span class="p">.</span><span class="n">attr</span>     <span class="c1"># Deleting
</span></code></pre></div></div>

<p>Its common to use properties as read only common use properties for example</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">height</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="p">.</span><span class="n">width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="p">.</span><span class="n">height</span>

<span class="c1"># Example use
</span><span class="n">b</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">area</span><span class="p">)</span>       <span class="c1"># -&gt; 20
</span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">perimeter</span><span class="p">)</span>  <span class="c1"># -&gt; 18
</span><span class="n">b</span><span class="p">.</span><span class="n">area</span> <span class="o">=</span> <span class="mi">5</span>          <span class="c1"># Error: can't set attribute
</span></code></pre></div></div>

<h3 id="types-interfaces-and-abstract-base-classes">Types, interfaces and abstract base classes</h3>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">My References</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">My References</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
