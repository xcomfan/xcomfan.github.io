<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Committing Your Work | My References</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Committing Your Work" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/gitref/comitting/rewrite_commits" />
<meta property="og:url" content="http://localhost:4000/gitref/comitting/rewrite_commits" />
<meta property="og:site_name" content="My References" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Committing Your Work" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Committing Your Work","url":"http://localhost:4000/gitref/comitting/rewrite_commits"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="My References" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">My References</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Committing Your Work</h1>
  </header>

  <div class="post-content">
    <h2 id="rewriting-commit-history">Rewriting commit history</h2>

<h3 id="interactive-rebase">Interactive rebase</h3>

<p>Git does not have a modify history tool, but you can use the rebase tool to rebase a series of commits onto the HEAD that they were originally based on.</p>

<p>With the interactive rebase tool you can stop after each commit you want to modify to change the commit message, add files to the commit or do whatever you wish.</p>

<p>For example if you want to change the last 3 commits you would use the command</p>

<p><code class="language-plaintext highlighter-rouge">git rebase -i HEAD~3</code></p>

<p>The -i option is for interactive rebase</p>

<p><strong><em>Note:</em></strong> This is a rebase command so <strong>DO NOT</strong> modify commits you already pushed to a remote repository.</p>

<p>Once you run the above command, Git will bring up an editor with a list of commits you selected listed newest first. The editor shows a script which the rebase will run as well as some hint information.</p>

<p>You need to edit this script replacing the word <code class="language-plaintext highlighter-rouge">pick</code> with one of the commands from the hint information provided.</p>

<p>If the command you write for a specific commit requires interactive rebase to give you a chance to make changes; when you save and exit the editor Git will rewind to the last commit in the list and start executing the script.  When it gets to the action that requires your input (<code class="language-plaintext highlighter-rouge">edit</code> or <code class="language-plaintext highlighter-rouge">reword</code> commands for example) Git will drop you into the command line with some hint information.  At this point you can make the needed changes and use <code class="language-plaintext highlighter-rouge">git commit --amend</code> to modify the commit the script stopped you at.  Once you are done editing the commit you can use the command <code class="language-plaintext highlighter-rouge">git rebase --continue</code> to continue executing the interactive rebase script.</p>

<p>When you save and exit the editor, Git will rewind you to the last commit in the list and drops you at the command line with some hint information displayed.</p>

<p>Once you are done modifying all the selected commits you will have a rewritten history.</p>

<p>If your want practice with interactive rebase go to <a href="https://git-rebase.io">git-rebase.io</a></p>

<h3 id="squashing-commits">Squashing Commits</h3>

<p>You can use the interactive rebase to take a series of commits and squash them into a single commit.  A common use for this is if you have multiple local commits that you with to squash into a single commit before pushing it to a remote repository.</p>

<p>First run the rebase command to go back the desired amount of commits</p>

<p><code class="language-plaintext highlighter-rouge">git rebase -i HEAD~3</code> where the number after <code class="language-plaintext highlighter-rouge">~</code> is how many commits you want to squash.</p>

<p>In the interactive rebase editor replace the <code class="language-plaintext highlighter-rouge">pick</code> keyword with <code class="language-plaintext highlighter-rouge">squash</code> on the lines representing the commits you with to squash.  Note that you need to have the first commit in the list presented set as pick.  You cannot squash without a previous commit which you are essentially squashing things into.</p>

<p>Once you have made you <code class="language-plaintext highlighter-rouge">squash</code> selections, ave the file and git will present you with another editor window this time for modifying the commit message.  Here you can set what the commit message will be for the squashed set of commits.  Once you save the changes Git will squash the commits.</p>

<p><strong><em>WARNING:</em></strong> <em>Only squash commits that are in your local repository and have not been pushed to a remote repository.  Squashing previously pushed commits and force pushing the branch will cause problems for your collaborators.</em></p>

<h3 id="splitting-commits">Splitting Commits</h3>

<p>The process of splitting a commit involves using interactive rebase undo your commits up to the commit you with to split.  You then rest the commit you wish to split and proceed to make as many new commits as needed to split up your commit.  Once you are done making commits that are the split version of the commit you are splitting you tell git rebase to continue and it re applies the commits made after the commit which was split.</p>

<p>To start the process you first need to run the <code class="language-plaintext highlighter-rouge">git rebase -i HEAD~3</code> command where the number after the <code class="language-plaintext highlighter-rouge">~</code> is how many commits you need to go back to get tot he commit you want to split.</p>

<p>In the script generated by the <code class="language-plaintext highlighter-rouge">rebase -i</code> command change the instruction on the commit you wish to split from <code class="language-plaintext highlighter-rouge">pick</code> to <code class="language-plaintext highlighter-rouge">edit</code>.</p>

<p>Once you save the changes to the script generated by interactive rebase you will be dropped at the command line with the rebase script stopped at the commit you wish to split.  You can use <code class="language-plaintext highlighter-rouge">git status</code> to check where in the interactive rebase script you are.</p>

<p>At this point you want to reset the commit you are on (the commit we are splitting).  You can do this with the command <code class="language-plaintext highlighter-rouge">git reset HEAD^</code>.  At this point the commit you are slitting has been undone and you can make as many changes and commits as you want to split the commit in a manner you desire.  Just use <code class="language-plaintext highlighter-rouge">git add some_file.txt</code> and <code class="language-plaintext highlighter-rouge">git commit -m 'One of the changes int the commit being split</code> to make as many changes as you need.</p>

<p>When done with committing the changes you are splitting the single commit into, use the command <code class="language-plaintext highlighter-rouge">git rebase --continue</code>.  At this point Git will re apply the changes that came after the commit you split.  You can validate that the split worked by viewing the commit history via <code class="language-plaintext highlighter-rouge">git log</code>.</p>

<p><strong><em>WARNING:</em></strong> <em>Only split commits that are in your local repository and have not been pushed to a remote repository.  Splitting previously pushed commits and force pushing the branch will cause problems for your collaborators.</em></p>

<h3 id="deleting-a-commit">Deleting a Commit</h3>

<p>Interactive rebase can also delete a commit.</p>

<p>To delete a commit begin interactive rebase the view the <code class="language-plaintext highlighter-rouge">git rebase -i HEAD~3</code> command (where 3 is the number of commits we wish to go back) and in the script that interactive rebase has you edit, put the word drop before the commit you want to delete.</p>

<p><strong><em>WARNING:</em></strong> The content of the commit which you delete will also be deleted from your repository.  For example if the commit you delete adds a file a.txt; a.txt will be removed from your repository.</p>

<p>Because of the way Git builds commit objects, deleting a commit will cause the rewriting of all the commits that follow it.  The further back you go, the more commits need to be created which can cause lots of merge conflicts.  If you get partway through a change like this and want to abort you can use the command below to return your repo to its state before you attempted the rebase.</p>

<p><code class="language-plaintext highlighter-rouge">git rebase --abort</code></p>

<p>If you finish a rebase and decide its not what you want, you can use git reflog to recover an earlier version of your branch.</p>

<h3 id="reordering-commits">Reordering Commits</h3>

<p>Similar to rewriting multiple commits, you can use interactive rebase to reorder or remove commits entirely.  In the example below if you want to remove the “Add cat file” commit and reorder the other two you would take the below interactive rebase script</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pick f7f3f6d Change my name a bit
pick 310154e Update README formatting and add blame
pick a5f4a0d Add cat-file
</code></pre></div></div>

<p>and change it to</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pick 310154e Update README formatting and add blame
pick f7f3f6d Change my name a bit
</code></pre></div></div>

<p>When you save and exit the editor, Git rewinds your branch to the parent of these commits, applies 310154e and then f7f3f6d and then stops.</p>

<p>At this point you effectively changed the order of those commits and remove the “Add-cat-file” commit completely.</p>

<p><strong><em>Note:</em></strong> This is a rebase command so <strong>DO NOT</strong> modify commits you already pushed.</p>

<h2 id="the-nuclear-option-filter-branch">The Nuclear Option: filter-branch</h2>

<p>The filter-branch option will rewrite huge swathes of your commit history.  <strong>Do not use it unless your project is not public or is worked on by a few people</strong></p>

<p>There is an alternative to filter-branch which you can find <a href="https://github.com/newren/git-filter-repo">here</a></p>

<p>If you are going to use filter-branch it is recommended you try in a backup copy of your repository.</p>

<h3 id="removing-a-file-from-every-commit">Removing a file from every commit</h3>

<p>This is useful if someone commits a giant binary file by mistake, or if someone commits a file with a password and you want to make the project public.</p>

<p>To remove a file called password.txt you would use the command below.  This command will remove the file passwords.txt from every commit whether it exists or not.</p>

<p><code class="language-plaintext highlighter-rouge">git filter-branch --tree-filter 'rm -f passwords.txt' HEAD</code></p>

<p>The <code class="language-plaintext highlighter-rouge">--tree-filter</code> option runs the specified command after each checkout of the project and then recommits the result.</p>

<p>If you want to run filter-branch on all of your branches you can pass the <code class="language-plaintext highlighter-rouge">--all</code> command.</p>

<h3 id="changing-email-address-globally">Changing email address globally</h3>

<p>The command below can globally update your email address.  You need to be careful to change only the email addresses that are yours so use the <code class="language-plaintext highlighter-rouge">--commit-filter</code> option.  <strong>This command will change every single commit in your history not just those that hve the matching email address.</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git filter-branch --commit-filter '
        if [ "$GIT_AUTHOR_EMAIL" = "myemail@mydomain" ];
        then
            GIT_AUTHOR_NAME="Your Name";
            GIT_AUTHOR_EMAIL="myemail@mydomain";
            git commit-tree "$@";
        else
            git commit-tree "$@";
        fi' HEAD
</code></pre></div></div>

<h3 id="making-a-subdirectory-the-new-root">Making a subdirectory the new root</h3>

<p>Suppose you have imported from another source control system and have subdirectories that make no sense (trunk, tags, etc.).  If you want to make the trunk subdirectory the new project root for every commit you can use the below command.</p>

<p><code class="language-plaintext highlighter-rouge">git filter-branch --subdirectory-filter trunk HEAD</code></p>

<p>Now your new project root is what was in the trunk subdirectory.  Git will also automatically remove commits that did not effect the subdirectory.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">My References</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">My References</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
